clear

echo "  -----------------------------[ screen $STEP of $STEPS ]----------------------------

  FUSION LINUX ESSENTIALS
  ---------------
  Fusion Linux is made by selecting best packages from Fedora and 
  RPMFusion repositories, and using Cinnamon instead of GNOME 3.

  In this step RPMFusion and Cinnamon repos will be added to
  existing Fedora software repositories along with essential
  audio and video codecs necessary for audio and video playback.
   
  Would you like to install Fusion Linux essentials now?

  You will be promted for your administrator password, so please
  have it ready.

  Note: additional packages listed as dependencies may also be installed.

  Hit any key to install Fusion Linux Essentials, or \"s\" to skip..."


read -n1 a
a=`echo $a | tr '[A-Z]' '[a-z]'`
if [ "$a" != "s" ]; then
    echo ""
    su - -c '# Fusion Linux Essentials
if [ -f /etc/yum.repos.d/fedora-cinnamon.repo ]; then
echo -e "Cinnamon repo is already present"
else
echo -e "Installing Cinnamon repo"
curl http://repos.fedorapeople.org/repos/leigh123linux/cinnamon/fedora-cinnamon.repo -o /etc/yum.repos.d/fedora-cinnamon.repo
fi
echo -e "Installing Cinnamon Desktop Manager"
yum install -y cinnamon

# RPM Fusion installation
if [ -f /etc/yum.repos.d/rpmfusion-free.repo ]; then
echo -e "RPM Fusion free repo already present"
else
echo -e "Installing RPM Fusion free repo"
yum -y localinstall --nogpgcheck http://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-stable.noarch.rpm
fi
if [ -f /etc/yum.repos.d/rpmfusion-nonfree.repo ]; then
echo -e "RPM Fusion nonfree repo already present"
else
echo -e "Installing RPM Fusion nonfree repo"
yum -y localinstall --nogpgcheck http://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-stable.noarch.rpm
fi

# Audio and video codecs installation
echo -e "Installing audio and video codecs"
yum install -y gnome-mplayer gstreamer-plugins-good gstreamer-plugins-bad gstreamer-plugins-bad-free gstreamer-plugins-bad-nonfree gstreamer-plugins-ugly gstreamer-ffmpeg faac faad2 libdca libmad libmatroska xvidcore
# Install MPlayer Codecs if Architecture is 32-bit
if [ $(uname -i) = "i386" ]; then
	if [ -d /usr/local/lib/codecs ]; then
	echo -e "MPlayer codecs already installed"
	else
	file="all-20110131.tar.bz2"
	get="http://www.mplayerhq.hu/MPlayer/releases/codecs/all-20110131.tar.bz2"
	GetFile
	tar -jxvf "$file"
	mkdir -p /usr/local/lib/codecs
	cp all-20110131/* /usr/local/lib/codecs
	ln -sf /usr/local/lib/codecs /usr/lib/codecs && ln -sf /usr/local/lib/codecs /usr/local/lib/win32 && ln -sf /usr/local/lib/codecs /usr/lib/win32
	fi
else
echo -e "Skipping installation of MPlayer codecs as it is only supported in 32-bit architecture"
# Remove possible defective thumbnails
rm -rf "~/.thumbnails/*"

# Installing Jockey driver installer
echo -e "Installing Jockey driver installer"
if [ -e /usr/bin/jockey-gtk ] || [ -e /usr/bin/jockey-kde ]; then
echo -e "Jockey Driver Installer already installed"
else

ParsidoraRepo
if ( [ "$(pidof ksmserver)" ] ); then
yum -y --enablerepo=parsidora install jockey-selinux jockey-kde
else
yum -y --enablerepo=parsidora install jockey-selinux jockey-gtk
fi
fi
if [ -e /usr/bin/jockey-gtk ] || [ -e /usr/bin/jockey-kde ]; then
Success
else
Failure

yum install -y --nogpgcheck fedorautils'

fi
